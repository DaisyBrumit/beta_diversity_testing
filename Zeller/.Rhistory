library(vegan)
library(tidyverse)
studyList <- c('Zeller', 'Jones', 'Vangay', 'Noguera-Julian', 'gemelli_ECAM')
qiime.list <- c('rpca', 'phylo_rpca')
study <- studyList[1]
setwd(paste0('~/beta_diversity_testing/',study,'/ordinations/')
)
getwd() # sanity check
setwd(paste0('~/beta_diversity_testing/',study))
getwd() # sanity check
### METADATA HANDLING: ONLY ONCE PER STUDY
# read in metadata
meta <- read.table('refiltered_meta.txt', header = TRUE, sep = '\t') %>%
filter(!rowSums(is.na(.) | . == "") == ncol(.)) # filter out rows with all na or empty values
View(meta)
# select binary column for plotting later
if(study == 'Zeller') {meta_col <- 'geographic_location'
colors <- c("Germany" = "pink", "France" = "darkgreen")
} else if(study == 'Jones') {meta_col <- 'Genotype'
colors <- c("GG" = "pink", "GA" = "darkgreen")
} else if(study == 'gemelli_ECAM') {meta_col <- 'delivery'
colors <- c("vaginal" = "pink", "cesarean" = "darkgreen")
} else if(study == 'Vangay') {meta_col <- 'Breastfed'
colors <- c("N" = "pink", "Y" = "darkgreen")
} else if(study == 'Noguera-Julian') {meta_col <- 'HIV_serostatus'
colors <- c("positive" = "pink", "negative" = "darkgreen")}
# finally, drop all rows where the specified feature is missing data
meta <- meta[!is.na(meta[meta_col]), ]
files <- list.files(pattern = 'bray_curtis_ordinations.tsv', recursive = TRUE)
# using filename, save actual beta method as a string
beta_method <- sub("_ordinations.tsv", "", file) # remove suffix
file <- files
# using filename, save actual beta method as a string
beta_method <- sub("_ordinations.tsv", "", file) # remove suffix
print(paste("Beta Method for", study, "=", beta_method)) #sanity check
# read in data as a table
data <- read.table(file, header=TRUE, sep='\t')
View(data)
# row 1 contains proportion var explained
prop_exp <- data[1,]
# isolate percent var explained and assign indices
colnames(data) <- sub("^X", "", colnames(data)) # list of new colnames
row.names(data) <- data[[1]] # assign dist matrix row names
data <- data[-1,] # we don't need prop explained here anymore
data <- data[,-1] # don't need index values as a column, either
View(data)
# meta and data must share id's
shared.indices <- intersect(meta$sampleid, rownames(data))
data <- data %>% filter(rownames(data) %in% shared.indices)
meta <- meta %>% filter(meta$sampleid %in% shared.indices)
# Create the scatter plot
plot.table <- data.frame(meta_col=as.factor(meta[[meta_col]]),
MDS1=data$PC1,
MDS2=data$PC2,
row.names=row.names(meta))
View(plot.table)
x.lab <- paste("MDS1:",as.character(round(prop_exp[2], digits=4))) # print first 4 decimals
y.lab <- paste("MDS2:",as.character(round(prop_exp[3], digits=4))) # print first 4 decimals
plot(plot.table$MDS1, plot.table$MDS2, pch = 19, col = colors[plot.table$meta_col],
xlab = x.lab, ylab = y.lab) # main plot with axes
title(main = paste(study, beta_method, "PCOA Results"), line = 1) # title
legend("topright", legend = levels(as.factor(meta[[meta_col]])), fill = colors, title = meta_col) # add legend
